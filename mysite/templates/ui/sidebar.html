{% load staticfiles %}
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="{% static 'ui/css/bootstrap.min.css' %}">
	<link rel="stylesheet" href="{% static 'ui/css/bootstrap.vertical-tabs.css' %}">
	<link rel="stylesheet" href="{% static 'ui/css/jasny-bootstrap.min.css' %}">
	<style type="text/css">
		@media (max-width: 767px){
			.col-sm-3, .col-sm-9, .row .col-sm-9, .row .col-sm-3 {
			width: 100%;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			}
		}	
	</style>
</head>
<body>
	<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
		  		<a class="navbar-brand btn" data-toggle="offcanvas" data-target="#coursesTree" data-canvas="body">Concept tree</a>
		  	</button>
			</div>
		</div>
    </nav>
    <div id="coursesTree" class="navmenu navmenu-default navmenu-fixed-left offcanvas" role="navigation" style="padding-top:5px; padding-right:5px;">
	 <div class="row" >
      <div  class="col-xs-3" style="padding-right:5px;">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs tabs-left sideways" sytle="border-right: solid 1px;" id="courses_tabs">
            <li class="active"><a href="#1" data-toggle="tab">Course 1</a></li>
          </ul>
        </div>
        <div class="col-xs-9">
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="panel_for_tabs">
                <div class="btn-group btn-group-justified" role="group" aria-label="units">
				  <div class="btn-group" role="group" style="width:80%;">
				    <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#unit1" aria-expanded="true" aria-controls="unit1">
						Unit name
					</button>
				  </div>
                </div>

                <div id="unit1" class="collapse in">
				  <div class="well">
            	<div class="btn-group btn-group-justified" role="group" aria-label="lessons">
				  <div class="btn-group" role="group" style="width:80%;">
				    <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#lesson1" aria-expanded="true"   aria-controls="lesson1">
						Lessons
					</button>
				  </div>
				  <div class="btn-group" role="group" style="width:20%;">
				    <button type="button" class="btn btn-default" >
				    	<span class="glyphicon glyphicon-plus-sign"></span>&nbsp;
				    </button>
				  </div>
				</div>	

				<div id="lesson1" class="collapse in">
				  <div class="well">
				  	<ul>
					  <li><a>Lesson 1</a></li>
					  <li><a>Lesson 2</a></li>
					  <li><a>Lesson 3</a></li>
					  <li><a>Lesson 4</a></li>
					  <li><a>Lesson 5</a></li>
					</ul>
				  </div>
				</div>

				<div class="btn-group btn-group-justified" role="group" aria-label="concepts">
				  <div class="btn-group" role="group" style="width:80%;">
				    <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#concept1" aria-expanded="true" aria-controls="concept1">
						Concepts
					</button>
				  </div>
				  <div class="btn-group" role="group" style="width:20%;">
				    <button type="button" class="btn btn-default" >
				    	<span class="glyphicon glyphicon-plus-sign"></span>&nbsp;
				    </button>
				  </div>
				</div>	

				<div id="concept1" class="collapse in">
				  <div class="well">
				  	<ul>
					  <li><a>Concept 1</a></li>
					  <li><a>Concept 2</a></li>
					  <li><a>Concept 3</a></li>
					  <li><a>Concept 4</a></li>
					</ul>
				  </div>
				</div>
            </div>
                          </div>
      </div>
            <div class="tab-pane" id="2">Course 2</div>
            <div class="tab-pane" id="3">Course 3</div>
            <div class="tab-pane" id="4">Course 4</div>
          </div>
        </div>
              </div>

  </div>
	    <div class="col-sm-9">
	      <lead>Bla bla bla</lead>
	    </div>

    <script src="//code.jquery.com//jquery-2.1.1.min.js"></script>
    <script src="{% static 'ui/js/bootstrap.min.js' %}"></script>
 	<script src="{% static 'ui/js/jasny-bootstrap.min.js' %}"></script>
    <script>
        function truncate(str, len){
          return (str.length > len) ? str.substr(0,len-3)+'&hellip;' : str;
        }

        function get_content_for_unit(unit_id){
           var url = '/ui/api/units/'+unit_id+'/content/';
           $('#panel_for_tabs').append('<div id="unit'+unit_id+'" class="collapse in"><div class="well"></div></div>');
           var tab_for_unit = $('#unit'+unit_id+' .well');
           $.get(url, {'format':'json'}).done(function(content) {
               var lessons = content['lessons'];
               var concepts = content['concepts'];
               tab_for_unit.append('<div class="btn-group btn-group-justified" role="group" aria-label="lessons"><div class="btn-group" role="group" style="width:80%;"><button type="button" class="btn btn-default" data-toggle="collapse" data-target="#lessons'+unit_id+'" aria-expanded="true" aria-controls="lesson1">Lessons</button></div><div class="btn-group" role="group" style="width:20%;"> <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus-sign"></span>&nbsp; </button> </div> </div>');
               tab_for_unit.append('<div id="lessons'+unit_id+'" class="collapse in"><div class="well"><ul></ul></div></div>');
               var lessons_tab = $('#lessons'+unit_id+' .well ul');
               for (lesson in lessons){
                   lessons_tab.append('<li><a href="#'+lessons[lesson]['id']+'" lesson_order="'+lessons[lesson]['order']+'">"'+lessons[lesson]['lesson_title']+'</a></li>');
               }
               tab_for_unit.append('<div class="btn-group btn-group-justified" role="group" aria-label="concepts"><div class="btn-group" role="group" style="width:80%;"><button type="button" class="btn btn-default" data-toggle="collapse" data-target="#concepts'+unit_id+'" aria-expanded="true" aria-controls="lesson1">Concepts</button></div><div class="btn-group" role="group" style="width:20%;"> <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus-sign"></span>&nbsp; </button> </div> </div>');
               tab_for_unit.append('<div id="concepts'+unit_id+'" class="collapse in"><div class="well"><ul></ul></div></div>');
               var conceptss_tab = $('#concepts'+unit_id+' .well ul');
               for (concept in concepts){
                   conceptss_tab.append('<li><a href="#'+concepts[concept]['ul_id']+'">'+concepts[concept]['title']+'</a></li>');
               }
           });
        }

        function get_units_for_course(course_id){
            var url = '/ui/api/courses/'+course_id+'/units/';
            $.get(url, {'format':'json'}).done(function(units) {
                this.course_tab = $('#panel_for_tabs');
                this.course_tab.empty();
                for (unit_num in units) {
                    var unit = units[unit_num];
                    var unit_tab_html = '<div class="btn-group btn-group-justified" role="group" aria-label="units"><div class="btn-group" role="group" style="width:80%;"> <button type="button" class="btn btn-default" data-toggle="collapse" data-target="#unit'+unit['unit_id']+'" aria-expanded="true" aria-controls="unit1">'+truncate(unit['unit_title'], 28)+'</button> </div> </div>';
                    this.course_tab.append(unit_tab_html);
                    get_content_for_unit(unit['unit_id']);
                }
            });
        }

        $(document).ready(function(){
            var url = '/ui/api/courses/'
            $.get(url, {'format':'json'}).done(function(courses) {
                this.courses_tabs = $('#courses_tabs');
                for (course_num in courses) {
                    var course = courses[course_num];
                    var course_tab_html = '<li><a href="#course_'+course['id']+'" data-toggle="tab" course-id="'+course['id']+'">'+course['title']+'</a></li>'
                    this.courses_tabs.append(course_tab_html);
                }
            });

        });

         $(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (course) {
                var course_id = $(course.target).attr('course-id');
                if (course_id) {
                    get_units_for_course(course_id);
                }
         });

    </script>
</body>
</html>
