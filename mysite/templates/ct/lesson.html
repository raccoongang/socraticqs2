{% extends "ct/portal.html" %}
{% load crispy_forms_tags %}
{% load ct_extras %}

{% comment %}
  Teacher's overview of a lesson
{% endcomment %}

{% block title %}
  {{ pageData.title }}
{% endblock %}

{% block refresher %}
{% if refreshInterval %}
<meta http-equiv="Refresh" content="{{ refreshInterval }}; url={{ actionTarget }}">
{% endif %}
{% endblock %}

{% block content %}

<ul class="nav nav-tabs">
  {% for tabLabel,tabURL in pageData.navTabs %}
  {% if "/" in tabURL %}
  <li><a href="{{ tabURL }}">{{ tabLabel }}</a></li>
  {% else %}
  <li class="active"><a href="{{ tabURL }}" id="{{ tabLabel }}TabA" data-toggle="tab">{{ tabLabel }}</a></li>
  {% endif %}
  {% endfor %}
  <li role="presentation" id="issues_tab"><a data-toggle="tab" href="#lesson_issues">Issues</a></li>
</ul>


<div class="tab-content">

<div id="lesson_issues" class="tab-pane fade">
    <br>
    <div class="row" id="lesson_issues_table">
    <div class="col-sm-5">
        <div class="input-group">
          <div class="input-group-btn">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Filters <span class="caret"></span></button>
                <ul class="dropdown-menu">

                </ul>
          </div><!-- /btn-group -->
            <input type="text" class="form-control">
        </div><!-- /input-group -->
    </div>
    <div class="col-sm-5">
      <div class="input-group">
          <div class="input-group-btn">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Labels <span class="caret"></span></button>
            <ul class="dropdown-menu">

            </ul>
          </div><!-- /btn-group -->
          <input type="text" class="form-control">
      </div><!-- /input-group -->
    </div>
    <div class="col-sm-2">
        <button class="btn btn-info" id="add_new_issue">Add new issue</button>
    </div>

    <hr>
    <table class="table">
        <thead>
        <th id="open_link_th" class="success">
            <a href="#" id="opened_issues"><span class="glyphicon glyphicon-exclamation-sign"></span> Open: <span id="open_span">0</span></a>
        </th>
        <th id="close_link_th">
           <a href="#" id="closed_issues"><span class="glyphicon glyphicon-ok"></span> Closed: <span id="closed_span">0</span></a>
        </th>
        <th>
        <div class="pull-right">
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Author <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="dropdown_author">
                <li role="separator" class="divider"></li>
                <li><a href="#" filter="all" field="author">Show all</a></li>
              </ul>
          </div>
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Labels <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="dropdown_labels">

                <li role="separator" class="divider"></li>
                <li><a href="#">Show all</a></li>
              </ul>
          </div>
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Assignee <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="dropdown_assignee">
                <li role="separator" class="divider"></li>
                <li><a href="#" filter="all" field="assignee">Show all</a></li>
              </ul>
          </div>
          <div class="btn-group">
              <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Sort <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">

              </ul>
          </div>
        </div>
        </th>
    </thead>
    </table>
        <table class="table table-condensed">
        <tbody id='table_of_issues'>
        </tbody>
        </table>
        </div>
    <div id="div_with_issue_form">

    </div>
    <div id="show_issue_div">

    </div>
</div>

<div class="tab-pane active" id="HomeTabDiv">

{% if addForm %}
  <b>This lesson is not part of this courselet.  You can add it to
  this courselet by clicking the Add button below.</b>
{% endif %}

{% if answer %}
  <input type="checkbox" id="headtoggle"/>Show Question<BR>
  <div id="headdiv" style="display: none">
{% endif %}

{{ unitLesson.lesson.text |md2html }}

{% if unitLesson.lesson.sourceDB == 'youtube' %}
<iframe width="560" height="315"
        src="http://www.youtube.com/embed/{{ unitLesson.lesson.sourceID }}?rel=0"
        frameborder="0" allowfullscreen></iframe>
{% elif unitLesson.lesson.sourceDB == 'vimeo' %}
<iframe width="500" height="281"
        src="http://player.vimeo.com/video/{{ unitLesson.lesson.sourceID }}"
        frameborder="0" webkitallowfullscreen mozallowfullscreen
        allowfullscreen></iframe>
{% endif %}

{% if unitLesson.lesson.url %}
<b>Read <a href="{{ unitLesson.lesson.url }}">more information here</a></b>.
<br>
{% endif %}

{% if answer %}
  </div>

<script>
$( "#headtoggle" ).click(function() {
  $( "#headdiv" ).toggle();
});
</script>

  <h3>Answer</h3>
  {{ answer.lesson.text |md2html }}
{% endif %}

{% if elapsedTime %}
  <b>Time Elapsed:</b> {{ elapsedTime }}<br>
  {% if answer %}
    When you are done presenting this answer, click Next:
  {% else %}
    When you are ready to present the answer to the students, click Next:
  {% endif %}
  {% if pageData.nextForm %}
    {% crispy pageData.nextForm %}
  {% endif %}
{% elif startForm %}
  When ready, click here to start the lesson timer:
  {% crispy startForm %}
{% endif %}

<b>Author</b>: <a href="/ct/people/{{ unitLesson.lesson.addedBy.pk }}/">{{ unitLesson.lesson.addedBy.get_full_name }}</a>
{% if statusTable %}
<h2>{{ statusTable.title }}</h2>

<table class="table table-striped">
  <thead><tr>
    {% for c in statusTable.headings %}
      <th>{{ c }}</th>
    {% endfor %}
  </tr></thead>
  <tbody><tr>
    {% for c in statusTable.data %}
    <td>{{ c }}</td>
    {% endfor %}
  </tr></tbody>
</table>
{% else %}
  <p>No students have responded yet.</p>
{% endif %}

{% if evalTable %}
<h2>Student Self-Assessments</h2>

<table class="table table-striped">
  <thead><tr>
    <th></th>
    <th>Wrong</th>
    <th>Close</th>
    <th>Correct</th>
  </tr></thead>
  <tbody>
  {% for label, row in evalTable %}
  <tr>
    <td><b>{{ label }}</b></td>
    {% for c in row %}
    <td>{{ c }}</td>
    {% endfor %}
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}

{% if addForm %}
  {% crispy addForm %}
{% elif roleForm and not unitLesson.parent %}
  {% crispy roleForm %}
{% endif %}



  </div><!-- @end #TeachTabDiv -->
</div>
{% endblock %}
